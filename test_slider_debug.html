<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–ª–∞–π–¥–µ—Ä–∞ - –û—Ç–ª–∞–¥–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .slide {
            transition: opacity 1s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">üñºÔ∏è –¢–µ—Å—Ç —Å–ª–∞–π–¥–µ—Ä–∞ - –û—Ç–ª–∞–¥–∫–∞</h1>
        
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üîß –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <div class="flex flex-wrap gap-4">
                <button onclick="testSliderAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    üì° –¢–µ—Å—Ç API —Å–ª–∞–π–¥–µ—Ä–∞
                </button>
                <button onclick="testSliderDebug()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    üîç –û—Ç–ª–∞–¥–∫–∞ —Å–ª–∞–π–¥–µ—Ä–∞
                </button>
                <button onclick="loadSliderTest()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–∞–π–¥–µ—Ä
                </button>
                <button onclick="clearResults()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div id="results" class="bg-gray-50 p-4 rounded text-sm font-mono overflow-auto max-h-96">
                –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...
            </div>
        </div>

        <!-- –ú–∏–Ω–∏-—Å–ª–∞–π–¥–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üñºÔ∏è –¢–µ—Å—Ç–æ–≤—ã–π —Å–ª–∞–π–¥–µ—Ä</h2>
            <div class="relative h-64 bg-gray-200 rounded-lg overflow-hidden">
                <div id="test-slider" class="relative h-full">
                    <div class="slide active absolute inset-0 transition-opacity duration-1000 opacity-100">
                        <div class="w-full h-full bg-gray-300 flex items-center justify-center text-gray-600 text-xl">
                            –°–ª–∞–π–¥–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
                        </div>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="absolute inset-x-0 top-1/2 flex justify-between items-center px-4 transform -translate-y-1/2">
                    <button id="test-slider-prev" class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70">
                        ‚óÄ
                    </button>
                    <button id="test-slider-next" class="bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-70">
                        ‚ñ∂
                    </button>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ API -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
            <h3 class="font-semibold text-blue-800 mb-2">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p class="text-blue-700">
                –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–π API —Å–ª–∞–π–¥–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å cases API.
                –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î –∏–∑ —Ñ–∞–π–ª–æ–≤ –ø–∞–ø–∫–∏ main-slider.
            </p>
        </div>
    </div>

    <script>
        let currentTestSlide = 0;
        let testSlides = [];

        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã...\n';
        }

        // –¢–µ—Å—Ç API —Å–ª–∞–π–¥–µ—Ä–∞
        async function testSliderAPI() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API /api/slider-images...');
            
            try {
                const response = await fetch('/api/slider-images');
                const data = await response.json();
                
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                log(`‚úÖ –£—Å–ø–µ—Ö: ${data.success}`);
                
                if (data.success && data.images) {
                    log(`üìä –ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${data.images.length}`);
                    
                    data.images.forEach((image, index) => {
                        log(`  ${index + 1}. ${image.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}`);
                        log(`     URL: ${image.url || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                        log(`     Direct URL: ${image.direct_url || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`);
                        log(`     Sort Order: ${image.sort_order}`);
                    });
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
                return data;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`);
                return null;
            }
        }

        // –¢–µ—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞
        async function testSliderDebug() {
            log('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API /api/debug/slider...');
            
            try {
                const response = await fetch('/api/debug/slider');
                const data = await response.json();
                
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status}`);
                log(`‚úÖ –£—Å–ø–µ—Ö: ${data.success}`);
                
                if (data.success && data.debug) {
                    const debug = data.debug;
                    log(`üìä –í –ë–î –Ω–∞–π–¥–µ–Ω–æ: ${debug.totalInDB} –∑–∞–ø–∏—Å–µ–π`);
                    log(`üìÅ –í —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ: ${debug.totalInFileSystem} —Ñ–∞–π–ª–æ–≤`);
                    log(`üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ${debug.recommendation}`);
                    
                    log('üìã –ó–∞–ø–∏—Å–∏ –≤ –ë–î:');
                    debug.sliderFromDB.forEach((slide, index) => {
                        log(`  ${index + 1}. ID: ${slide.id}, Order: ${slide.sort_order}`);
                        log(`     Title: ${slide.title}`);
                        log(`     URL Status: ${slide.url_status}`);
                        log(`     Direct URL Status: ${slide.direct_url_status}`);
                    });
                    
                    log('üìÅ –§–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º–µ:');
                    debug.fileSystemInfo.forEach((file, index) => {
                        log(`  ${index + 1}. ${file.fileName}`);
                        log(`     Expected URL: ${file.expectedUrl}`);
                    });
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞
        async function loadSliderTest() {
            log('üñºÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞...');
            
            try {
                const data = await testSliderAPI();
                
                if (!data || !data.success || !data.images || data.images.length === 0) {
                    log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞');
                    return;
                }
                
                const sliderContainer = document.getElementById('test-slider');
                sliderContainer.innerHTML = '';
                testSlides = data.images;
                
                log(`üî® –°–æ–∑–¥–∞–Ω–∏–µ ${testSlides.length} —Å–ª–∞–π–¥–æ–≤...`);
                
                // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥—ã
                testSlides.forEach((image, index) => {
                    const slideDiv = document.createElement('div');
                    slideDiv.className = `slide absolute inset-0 transition-opacity duration-1000 ${index === 0 ? 'opacity-100 active' : 'opacity-0'}`;
                    
                    if (image.url) {
                        const imgElement = document.createElement('img');
                        imgElement.className = 'w-full h-full object-cover';
                        imgElement.alt = image.alt_text || `–°–ª–∞–π–¥ ${index + 1}`;
                        imgElement.src = image.direct_url || image.url;
                        
                        imgElement.onload = function() {
                            log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω —Å–ª–∞–π–¥ ${index + 1}: ${image.title}`);
                        };
                        
                        imgElement.onerror = function() {
                            log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–∞–π–¥–∞ ${index + 1}: ${image.title}`);
                            slideDiv.innerHTML = `
                                <div class="w-full h-full bg-red-100 flex items-center justify-center text-red-600">
                                    <div class="text-center">
                                        <div class="text-2xl mb-2">‚ö†Ô∏è</div>
                                        <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                                        <div class="text-sm">${image.title}</div>
                                    </div>
                                </div>
                            `;
                        };
                        
                        slideDiv.appendChild(imgElement);
                    } else {
                        slideDiv.innerHTML = `
                            <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-600">
                                <div class="text-center">
                                    <div class="text-2xl mb-2">üñºÔ∏è</div>
                                    <div>${image.title}</div>
                                    <div class="text-sm">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    sliderContainer.appendChild(slideDiv);
                });
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                setupTestSliderControls();
                
                log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–ª–∞–π–¥–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–∞–π–¥–µ—Ä–∞: ${error.message}`);
            }
        }

        function setupTestSliderControls() {
            const prevBtn = document.getElementById('test-slider-prev');
            const nextBtn = document.getElementById('test-slider-next');
            
            prevBtn.onclick = function() {
                changeTestSlide(-1);
            };
            
            nextBtn.onclick = function() {
                changeTestSlide(1);
            };
        }

        function changeTestSlide(direction) {
            if (testSlides.length === 0) return;
            
            const slides = document.querySelectorAll('#test-slider .slide');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ª–∞–π–¥
            slides[currentTestSlide].classList.remove('active');
            slides[currentTestSlide].style.opacity = '0';
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
            currentTestSlide = (currentTestSlide + direction + testSlides.length) % testSlides.length;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —Å–ª–∞–π–¥
            slides[currentTestSlide].classList.add('active');
            slides[currentTestSlide].style.opacity = '1';
            
            log(`üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–∞–π–¥ ${currentTestSlide + 1}: ${testSlides[currentTestSlide].title}`);
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!');
            log('üí° –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç API —Å–ª–∞–π–¥–µ—Ä–∞" –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏.');
        });
    </script>
</body>
</html> 