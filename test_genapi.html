<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç GenAPI - Flux Kontext</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn {
            @apply px-6 py-3 rounded-lg font-medium transition-all duration-300 cursor-pointer;
        }
        .bg-gold-1 { background-color: #D4AF37; }
        .bg-gold-2 { background-color: #B8941F; }
        .text-gold-1 { color: #D4AF37; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-2 text-gray-800">
                üß™ –¢–µ—Å—Ç GenAPI - Flux Kontext
            </h1>
            <p class="text-center text-gray-600 mb-8">
                –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ò–ò –¥–∏–∑–∞–π–Ω–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
            </p>

            <!-- –°—Ç–∞—Ç—É—Å API -->
            <div id="api-status" class="mb-8 p-4 rounded-lg border">
                <h3 class="font-semibold mb-2">üìä –°—Ç–∞—Ç—É—Å API:</h3>
                <button onclick="checkAPIStatus()" class="btn bg-blue-500 text-white hover:bg-blue-600">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                </button>
                <div id="status-result" class="mt-4"></div>
            </div>

            <!-- –õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏ -->
            <div class="mb-8 p-4 rounded-lg border bg-gray-50">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-semibold">üîç –õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π):</h3>
                    <button onclick="clearLog()" class="btn bg-gray-500 text-white hover:bg-gray-600 text-sm px-3 py-1">
                        –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
                <div id="debug-log" class="bg-white p-3 rounded border max-h-32 overflow-y-auto font-mono text-xs">
                    <div class="text-gray-500">–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
                </div>
                <div class="mt-2 text-xs text-gray-600">
                    üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π!
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <form id="ai-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞:
                    </label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gold-1 transition-colors">
                        <input type="file" id="photo-upload" accept="image/*" class="hidden" />
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-gray-600 mb-2">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</p>
                        <button type="button" onclick="document.getElementById('photo-upload').click()" class="btn bg-gold-1 text-black hover:bg-gold-2">
                            –í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">üé® –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:</label>
                    <select id="style-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold-1 focus:border-transparent">
                        <option value="scandinavian">–°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π</option>
                        <option value="minimalist">–ú–∏–Ω–∏–º–∞–ª–∏–∑–º</option>
                        <option value="modern">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</option>
                        <option value="loft">–õ–æ—Ñ—Ç</option>
                        <option value="classic">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</option>
                        <option value="provence">–ü—Ä–æ–≤–∞–Ω—Å</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‚úèÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:</label>
                    <textarea id="prompt-input" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold-1 focus:border-transparent" 
                              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –±–æ–ª–µ–µ —Å–≤–µ—Ç–ª–æ–π, –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ç–µ–Ω–∏—è, –ø–æ–º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç –¥–∏–≤–∞–Ω–∞ –Ω–∞ —Å–∏–Ω–∏–π"></textarea>
                </div>

                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ -->
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –ü–õ–ê–¢–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ~20-30‚ÇΩ –∑–∞ –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</li>
                                    <li><strong>–í—Ä–µ–º—è:</strong> 10-15 —Å–µ–∫—É–Ω–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</li>
                                    <li><strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> –í—ã—Å–æ–∫–æ–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É</li>
                                    <li><strong>–û—Ç–º–µ–Ω–∞:</strong> –ù–µ–≤–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</li>
                                </ul>
                            </div>
                            <div class="mt-2 text-xs text-red-600">
                                üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–¥ –Ω–∞–∂–∞—Ç–∏–µ–º –∫–Ω–æ–ø–∫–∏!
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" id="submit-btn" class="w-full btn bg-red-600 text-white hover:bg-red-700 font-semibold text-lg py-4 transition-colors">
                    üí∏ –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ó–ê –î–ï–ù–¨–ì–ò (Flux Kontext)
                </button>
            </form>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <div id="result-section" class="mt-8 hidden">
                <h3 class="text-xl font-semibold mb-4">üì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-2 text-center">–ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h4>
                        <div class="bg-gray-100 rounded-lg overflow-hidden">
                            <img id="original-img" src="" alt="–ò—Å—Ö–æ–¥–Ω–æ–µ" class="w-full h-auto">
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2 text-center">–ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω</h4>
                        <div class="bg-gray-100 rounded-lg overflow-hidden">
                            <img id="edited-img" src="" alt="–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ" class="w-full h-auto">
                        </div>
                    </div>
                </div>
                <div id="result-info" class="mt-4 p-4 bg-gray-50 rounded-lg"></div>
            </div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white p-8 rounded-lg max-w-md w-full mx-4">
                    <div class="text-center">
                        <div class="animate-spin h-12 w-12 text-gold-1 mx-auto mb-4">
                            <svg fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∏–∑–∞–π–Ω...</h3>
                        <p class="text-gray-600 text-sm">Flux Kontext –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                        <p class="text-gray-500 text-xs mt-2">–û–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç 10-15 —Å–µ–∫—É–Ω–¥</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        let logMessages = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);
            
            console.log(`%c${logEntry}`, type === 'error' ? 'color: red' : type === 'warning' ? 'color: orange' : 'color: blue');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            updateLogDisplay();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–æ–≤
        function updateLogDisplay() {
            const logDiv = document.getElementById('debug-log');
            if (logDiv) {
                const recentLogs = logMessages.slice(-10);
                logDiv.innerHTML = recentLogs.map(msg => {
                    let className = 'text-gray-600';
                    if (msg.includes('‚ùå')) className = 'text-red-600';
                    else if (msg.includes('‚ö†Ô∏è')) className = 'text-orange-600';
                    else if (msg.includes('‚úÖ')) className = 'text-green-600';
                    else if (msg.includes('üí∞') || msg.includes('üí∏')) className = 'text-red-700 font-bold';
                    
                    return `<div class="text-xs ${className} mb-1">${msg}</div>`;
                }).join('');
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤
        function clearLog() {
            logMessages = [];
            const logDiv = document.getElementById('debug-log');
            if (logDiv) {
                logDiv.innerHTML = '<div class="text-gray-500">–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...</div>';
            }
            addLog('üßπ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API
        async function checkAPIStatus() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.innerHTML = '<div class="text-blue-600">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>';
            
            addLog('üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ API...');
            
            try {
                addLog('üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ /api/health');
                const response = await fetch('/api/health');
                addLog(`üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                addLog('üìÑ JSON –æ—Ç–≤–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                
                const genapiStatus = data.genapi?.ready ? '‚úÖ' : '‚ùå';
                const genapiLength = data.genapi?.tokenLength || 0;
                const genapiPresent = data.genapi?.tokenPresent || false;
                
                addLog(`üîë GenAPI —Ç–æ–∫–µ–Ω: ${genapiPresent ? '–ù–ê–ô–î–ï–ù' : '–ù–ï –ù–ê–ô–î–ï–ù'} (${genapiLength} —Å–∏–º–≤–æ–ª–æ–≤)`);
                
                if (!genapiPresent || genapiLength === 0) {
                    addLog('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: GenAPI —Ç–æ–∫–µ–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ.', 'warning');
                } else {
                    addLog('‚úÖ GenAPI —Ç–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é');
                    addLog(`üí∞ –ì–æ—Ç–æ–≤ –∫ –ø–ª–∞—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ${data.apis?.genapi?.provider || 'GenAPI'}`);
                }
                
                resultDiv.innerHTML = `
                    <div class="space-y-2 text-sm">
                        <div><strong>–°–µ—Ä–≤–µ—Ä:</strong> ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (v${data.version})</div>
                        <div><strong>GenAPI:</strong> ${genapiStatus} ${data.apis?.genapi?.status || 'unknown'}</div>
                        <div><strong>–ü—Ä–æ–≤–∞–π–¥–µ—Ä:</strong> ${data.apis?.genapi?.provider || 'gen-api.ru'}</div>
                        <div><strong>–ú–æ–¥–µ–ª—å:</strong> ${data.apis?.genapi?.model || 'flux-kontext'}</div>
                        <div><strong>GenAPI —Ç–æ–∫–µ–Ω:</strong> ${genapiPresent ? `–ó–∞–≥—Ä—É–∂–µ–Ω (${genapiLength} —Å–∏–º–≤–æ–ª–æ–≤)` : '–ù–µ –Ω–∞–π–¥–µ–Ω'}</div>
                        <div class="text-xs text-gray-500 mt-2">–í—Ä–µ–º—è: ${data.timestamp}</div>
                        ${!genapiPresent ? '<div class="text-red-600 text-sm mt-2">‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω - –±—É–¥–µ—Ç –¥–µ–º–æ —Ä–µ–∂–∏–º</div>' : '<div class="text-green-600 text-sm mt-2">‚úÖ –ì–æ—Ç–æ–≤ –∫ –ø–ª–∞—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>'}
                    </div>
                `;
                
                addLog('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`, 'error');
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('ai-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fileInput = document.getElementById('photo-upload');
            const styleSelect = document.getElementById('style-select');
            const promptInput = document.getElementById('prompt-input');
            const submitBtn = document.getElementById('submit-btn');
            const loading = document.getElementById('loading');
            const resultSection = document.getElementById('result-section');
            
            addLog('üöÄ === –ù–ê–ß–ê–õ–û –ì–ï–ù–ï–†–ê–¶–ò–ò –ò–ò –î–ò–ó–ê–ô–ù–ê ===');
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if (!fileInput.files[0]) {
                addLog('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞: —Ñ–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω', 'error');
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                return;
            }
            
            if (!promptInput.value.trim()) {
                addLog('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞: –ø—Ä–æ–º—Ç –ø—É—Å—Ç–æ–π', 'error');
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è');
                return;
            }
            
            const file = fileInput.files[0];
            const style = styleSelect.value;
            const prompt = promptInput.value.trim();
            
            addLog(`‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞:`);
            addLog(`   üìÅ –§–∞–π–ª: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
            addLog(`   üé® –°—Ç–∏–ª—å: ${style}`);
            addLog(`   ‚úèÔ∏è –ü—Ä–æ–º—Ç: "${prompt.substring(0, 50)}${prompt.length > 50 ? '...' : ''}"`);
            
            // –í–ê–ñ–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï –û –°–¢–û–ò–ú–û–°–¢–ò
            const confirmGeneration = confirm(
                `‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –ü–õ–ê–¢–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø ‚ö†Ô∏è\n\n` +
                `–°—Ç–æ–∏–º–æ—Å—Ç—å: ~20-30‚ÇΩ –∑–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n` +
                `–§–∞–π–ª: ${file.name}\n` +
                `–°—Ç–∏–ª—å: ${style}\n` +
                `–ü—Ä–æ–º—Ç: ${prompt}\n\n` +
                `–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é?`
            );
            
            if (!confirmGeneration) {
                addLog('üõë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                return;
            }
            
            addLog('üí∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –ø–ª–∞—Ç–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loading.classList.remove('hidden');
            submitBtn.disabled = true;
            submitBtn.textContent = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º...';
            
            const startTime = Date.now();
            addLog(`‚è±Ô∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å –≤ ${new Date().toLocaleTimeString()}`);
            
            try {
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                addLog('üì¶ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º FormData...');
                const formData = new FormData();
                formData.append('image', file);
                formData.append('style', style);
                formData.append('prompt', prompt);
                addLog('‚úÖ FormData –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞');
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
                addLog('üåê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –∑–∞–ø—Ä–æ—Å –∫ /api/ai-design-genapi');
                addLog(`üì° URL: ${window.location.origin}/api/ai-design-genapi`);
                
                const response = await fetch('/api/ai-design-genapi', {
                    method: 'POST',
                    body: formData
                });
                
                const responseTime = Date.now() - startTime;
                addLog(`üì• –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –∑–∞ ${responseTime}–º—Å`);
                addLog(`üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`);
                addLog(`üìÑ Content-Type: ${response.headers.get('content-type')}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    addLog(`‚ùå HTTP –æ—à–∏–±–∫–∞: ${response.status}`, 'error');
                    addLog(`‚ùå –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: ${errorText}`, 'error');
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                addLog('üìÑ –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç...');
                const result = await response.json();
                addLog('‚úÖ JSON –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω');
                
                // –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                addLog(`üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:`);
                addLog(`   ‚úÖ –£—Å–ø–µ—Ö: ${result.success}`);
                addLog(`   üé® –°—Ç–∏–ª—å: ${result.style}`);
                addLog(`   ü§ñ –ú–æ–¥–µ–ª—å: ${result.model}`);
                addLog(`   üè¢ –ü—Ä–æ–≤–∞–π–¥–µ—Ä: ${result.provider}`);
                addLog(`   üß™ –î–µ–º–æ —Ä–µ–∂–∏–º: ${result.demo ? '–î–ê' : '–ù–ï–¢'}`);
                
                if (result.demo) {
                    addLog('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –†–∞–±–æ—Ç–∞ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ - –¥–µ–Ω—å–≥–∏ –ù–ï —Å–ø–∏—Å–∞–Ω—ã', 'warning');
                } else {
                    addLog('üí∏ –í–ù–ò–ú–ê–ù–ò–ï: –†–µ–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è - –¥–µ–Ω—å–≥–∏ –°–ü–ò–°–ê–ù–´', 'warning');
                }
                
                if (result.success) {
                    const totalTime = Date.now() - startTime;
                    addLog(`‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${totalTime}–º—Å (${(totalTime/1000).toFixed(1)}—Å)`);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    if (result.originalImage) {
                        addLog(`üñºÔ∏è –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${result.originalImage.length} —Å–∏–º–≤–æ–ª–æ–≤ base64`);
                    }
                    if (result.editedImage) {
                        addLog(`üñºÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${result.editedImage.length} —Å–∏–º–≤–æ–ª–æ–≤ base64`);
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    document.getElementById('original-img').src = result.originalImage;
                    document.getElementById('edited-img').src = result.editedImage;
                    document.getElementById('result-info').innerHTML = `
                        <div class="space-y-2 text-sm">
                            <div><strong>–°—Ç–∏–ª—å:</strong> ${result.style}</div>
                            <div><strong>–ú–æ–¥–µ–ª—å:</strong> ${result.model}</div>
                            <div><strong>–ü—Ä–æ–≤–∞–π–¥–µ—Ä:</strong> ${result.provider}</div>
                            <div><strong>–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</strong> ${(totalTime/1000).toFixed(1)}—Å</div>
                            ${result.demo ? '<div class="text-orange-600"><strong>–†–µ–∂–∏–º:</strong> –î–µ–º–æ (–¥–µ–Ω—å–≥–∏ –ù–ï —Å–ø–∏—Å–∞–Ω—ã)</div>' : '<div class="text-red-600"><strong>–†–µ–∂–∏–º:</strong> –ü–ª–∞—Ç–Ω—ã–π (–¥–µ–Ω—å–≥–∏ –°–ü–ò–°–ê–ù–´)</div>'}
                            <div class="text-gray-600"><strong>–ü—Ä–æ–º—Ç:</strong> ${result.prompt}</div>
                            ${result.error ? `<div class="text-red-600"><strong>–û—à–∏–±–∫–∞:</strong> ${result.error}</div>` : ''}
                        </div>
                    `;
                    resultSection.classList.remove('hidden');
                    
                    addLog('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ');
                    addLog('üéâ === –ì–ï–ù–ï–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û ===');
                    
                } else {
                    addLog(`‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å: ${result.error}`, 'error');
                    alert('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ' + result.error);
                }
                
            } catch (error) {
                const totalTime = Date.now() - startTime;
                addLog(`‚ùå === –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ì–ï–ù–ï–†–ê–¶–ò–ò ===`, 'error');
                addLog(`‚ùå –í—Ä–µ–º—è –¥–æ –æ—à–∏–±–∫–∏: ${totalTime}–º—Å`, 'error');
                addLog(`‚ùå –¢–∏–ø –æ—à–∏–±–∫–∏: ${error.name}`, 'error');
                addLog(`‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`, 'error');
                if (error.stack) {
                    addLog(`‚ùå Stack: ${error.stack.split('\n')[0]}`, 'error');
                }
                
                console.error('–ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message);
                
            } finally {
                const totalTime = Date.now() - startTime;
                addLog(`üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ ${totalTime}–º—Å`);
                
                loading.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = 'üí∏ –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ó–ê –î–ï–ù–¨–ì–ò (Flux Kontext)';
                
                addLog('üîÑ UI –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        document.getElementById('photo-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const uploadArea = e.target.parentElement;
                uploadArea.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500 mb-2 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <p class="text-center mb-2"><strong>–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:</strong></p>
                    <p class="text-center text-sm text-gray-600 mb-3">${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</p>
                    <button type="button" class="btn bg-gold-1 text-black hover:bg-gold-2" onclick="document.getElementById('photo-upload').click()">
                        –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª
                    </button>
                    <input id="photo-upload" type="file" accept="image/*" class="hidden" />
                `;
                
                // –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                document.getElementById('photo-upload').addEventListener('change', arguments.callee);
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', checkAPIStatus);
    </script>
</body>
</html> 