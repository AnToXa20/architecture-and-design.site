<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —É—Å–ª—É–≥ - –û—Ç–ª–∞–¥–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .service-item {
            transition: all 0.3s ease;
        }
        .service-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">üõ†Ô∏è –¢–µ—Å—Ç —É—Å–ª—É–≥ - –û—Ç–ª–∞–¥–∫–∞</h1>
        
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">üîß –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <div class="flex flex-wrap gap-4">
                <button onclick="testServicesAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    üîÑ –¢–µ—Å—Ç API —É—Å–ª—É–≥
                </button>
                <button onclick="testServicesDebug()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    üîç –û—Ç–ª–∞–¥–∫–∞ —É—Å–ª—É–≥
                </button>
                <button onclick="loadServicesImages()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                </button>
                <button onclick="clearResults()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                </button>
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API -->
        <div id="api-results" class="bg-white rounded-lg shadow p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold mb-4">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã API</h2>
            <div id="api-content" class="space-y-4"></div>
        </div>
        
        <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="debug-info" class="bg-white rounded-lg shadow p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold mb-4">üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div id="debug-content" class="space-y-4"></div>
        </div>
        
        <!-- –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-6">üëÄ –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div class="service-item">
                    <h3 class="text-lg font-semibold mb-3">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                    <div class="h-64 rounded-lg overflow-hidden relative bg-gray-100">
                        <img 
                            id="architecture-image" 
                            src="" 
                            alt="–ß–µ—Ä—Ç–µ–∂ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞" 
                            class="w-full h-full object-cover rounded-lg hidden"
                        >
                        <div id="architecture-placeholder" class="h-full bg-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500">–ß–µ—Ä—Ç–µ–∂ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</span>
                        </div>
                    </div>
                </div>
                
                <!-- –î–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ -->
                <div class="service-item">
                    <h3 class="text-lg font-semibold mb-3">–î–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞</h3>
                    <div class="h-64 rounded-lg overflow-hidden relative bg-gray-100">
                        <img 
                            id="interior-image" 
                            src="" 
                            alt="–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞" 
                            class="w-full h-full object-cover rounded-lg hidden"
                        >
                        <div id="interior-placeholder" class="h-full bg-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞</span>
                        </div>
                    </div>
                </div>
                
                <!-- –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω -->
                <div class="service-item">
                    <h3 class="text-lg font-semibold mb-3">–õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω</h3>
                    <div class="h-64 rounded-lg overflow-hidden relative bg-gray-100">
                        <img 
                            id="landscape-image" 
                            src="" 
                            alt="–ü–ª–∞–Ω –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞" 
                            class="w-full h-full object-cover rounded-lg hidden"
                        >
                        <div id="landscape-placeholder" class="h-full bg-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500">–ü–ª–∞–Ω –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –õ–æ–≥–∏ -->
        <div class="mt-8 bg-black text-green-400 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üìã –õ–æ–≥–∏</h3>
            <div id="logs" class="font-mono text-sm space-y-1 max-h-64 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–æ–≤
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400',
                success: 'text-blue-400'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || 'text-green-400';
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }
        
        // –¢–µ—Å—Ç API —É—Å–ª—É–≥
        async function testServicesAPI() {
            addLog('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —É—Å–ª—É–≥...');
            
            try {
                const response = await fetch('/api/services');
                const result = await response.json();
                
                addLog(`‚úÖ API –æ—Ç–≤–µ—Ç–∏–ª: ${response.status} ${response.statusText}`, 'success');
                addLog(`üìä –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(result, null, 2)}`, 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const apiResults = document.getElementById('api-results');
                const apiContent = document.getElementById('api-content');
                
                apiContent.innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded p-4">
                            <h3 class="font-semibold text-green-800">–°—Ç–∞—Ç—É—Å API</h3>
                            <p class="text-green-700">–£—Å–ø–µ—à–Ω–æ: ${result.success}</p>
                            <p class="text-green-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${result.count}</p>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded p-4">
                            <h3 class="font-semibold text-blue-800">–î–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥</h3>
                            <pre class="text-sm text-blue-700 bg-blue-100 p-2 rounded overflow-x-auto">${JSON.stringify(result.data, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
                apiResults.classList.remove('hidden');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ API —É—Å–ª—É–≥:', error);
            }
        }
        
        // –¢–µ—Å—Ç –æ—Ç–ª–∞–¥–∫–∏ —É—Å–ª—É–≥
        async function testServicesDebug() {
            addLog('üîç –ó–∞–ø—É—Å–∫ –æ—Ç–ª–∞–¥–∫–∏ —É—Å–ª—É–≥...');
            
            try {
                const response = await fetch('/api/debug/services');
                const result = await response.json();
                
                addLog(`‚úÖ –û—Ç–ª–∞–¥–∫–∞ –æ—Ç–≤–µ—Ç–∏–ª–∞: ${response.status} ${response.statusText}`, 'success');
                addLog(`üîç –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã`, 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const debugInfo = document.getElementById('debug-info');
                const debugContent = document.getElementById('debug-content');
                
                debugContent.innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-4">
                            <h3 class="font-semibold text-yellow-800">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è</h3>
                            <p class="text-yellow-700">${result.debug.recommendation}</p>
                        </div>
                        
                        <div class="bg-purple-50 border border-purple-200 rounded p-4">
                            <h3 class="font-semibold text-purple-800">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î</h3>
                            <p class="text-purple-700">–£—Å–ª—É–≥ –≤ –ë–î: ${result.debug.totalInDB}</p>
                            <p class="text-purple-700">–§–∞–π–ª–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ: ${result.debug.totalInFileSystem}</p>
                        </div>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded p-4">
                            <h3 class="font-semibold text-gray-800">–î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î</h3>
                            <pre class="text-sm text-gray-700 bg-gray-100 p-2 rounded overflow-x-auto">${JSON.stringify(result.debug.servicesFromDB, null, 2)}</pre>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded p-4">
                            <h3 class="font-semibold text-green-800">–§–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º–µ</h3>
                            <pre class="text-sm text-green-700 bg-green-100 p-2 rounded overflow-x-auto">${JSON.stringify(result.debug.fileSystemInfo, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
                debugInfo.classList.remove('hidden');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ª–∞–¥–∫–∏: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ª–∞–¥–∫–∏ —É—Å–ª—É–≥:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É—Å–ª—É–≥ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ services.html)
        async function loadServicesImages() {
            addLog('üñºÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å–ª—É–≥...');
            
            try {
                const response = await fetch('/api/services');
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É—Å–ª—É–≥');
                }
                
                const images = result.data;
                addLog(`üìä –ü–æ–ª—É—á–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${images.length}`, 'success');
                
                // –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
                const imageMapping = {
                    '3d': { imgId: 'architecture-image', placeholderId: 'architecture-placeholder' },
                    'blueprint': { imgId: 'interior-image', placeholderId: 'interior-placeholder' }, 
                    'landscape': { imgId: 'landscape-image', placeholderId: 'landscape-placeholder' }
                };
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                images.forEach((image, index) => {
                    let imageType = '';
                    const title = (image.title || image.alt_text || '').toLowerCase();
                    
                    if (title.includes('3d') || title.includes('–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è')) {
                        imageType = '3d';
                    } else if (title.includes('blueprint') || title.includes('–¥–∏–∑–∞–π–Ω')) {
                        imageType = 'blueprint';
                    } else if (title.includes('landscape') || title.includes('–ª–∞–Ω–¥—à–∞—Ñ—Ç')) {
                        imageType = 'landscape';
                    }
                    
                    if (!imageType) {
                        const typesByOrder = ['3d', 'blueprint', 'landscape'];
                        imageType = typesByOrder[image.sort_order] || typesByOrder[index];
                    }
                    
                    const mapping = imageMapping[imageType];
                    if (mapping) {
                        const imgElement = document.getElementById(mapping.imgId);
                        const placeholderElement = document.getElementById(mapping.placeholderId);
                        
                        if (imgElement && placeholderElement) {
                            addLog(`üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º ${imageType}: ${image.title}`);
                            
                            if (image.direct_url) {
                                imgElement.onload = function() {
                                    addLog(`‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${imageType} –∑–∞–≥—Ä—É–∂–µ–Ω–æ`, 'success');
                                    this.classList.remove('hidden');
                                    placeholderElement.style.display = 'none';
                                };
                                
                                imgElement.onerror = function() {
                                    addLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${imageType}`, 'error');
                                    this.classList.add('hidden');
                                    placeholderElement.style.display = 'flex';
                                };
                                
                                imgElement.src = image.direct_url;
                            } else {
                                addLog(`‚ö†Ô∏è –ù–µ—Ç URL –¥–ª—è ${imageType}`, 'warning');
                            }
                        }
                    }
                });
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É—Å–ª—É–≥:', error);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function clearResults() {
            document.getElementById('api-results').classList.add('hidden');
            document.getElementById('debug-info').classList.add('hidden');
            document.getElementById('logs').innerHTML = '';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫–∏
            document.querySelectorAll('[id$="-image"]').forEach(img => {
                img.classList.add('hidden');
                img.src = '';
            });
            
            document.querySelectorAll('[id$="-placeholder"]').forEach(placeholder => {
                placeholder.style.display = 'flex';
            });
            
            addLog('üóëÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'info');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–ª–∞–¥–∫–∏ —É—Å–ª—É–≥ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            addLog('üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
        });
    </script>
</body>
</html> 