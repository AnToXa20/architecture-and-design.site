<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Статья - Архитектурное Бюро</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'white': '#FFFFFF',
                        'black': '#000000',
                        'light-gray': '#E6E6E6',
                        'gray': '#A6A6A6',
                        'dark-gray': '#2F2F2F',
                        'gold-1': '#FFC107',
                        'gold-2': '#E8A317',
                    },
                    fontFamily: {
                        'montserrat': ['Montserrat', 'sans-serif'],
                        'roboto': ['Roboto', 'sans-serif'],
                        'playfair': ['Playfair Display', 'serif'],
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Стили для мобильного меню */
        .mobile-menu-link {
            display: block;
            padding: 16px 24px;
            text-decoration: none;
            color: #2F2F2F;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s ease;
            border-bottom: 1px solid #E6E6E6;
            width: 100%;
        }
        
        .mobile-menu-link:hover {
            background-color: #FFC107;
            color: #000;
            padding-left: 32px;
        }
        
        .mobile-menu-link:last-child {
            border-bottom: none;
        }
        
        /* Стили для мобильного меню контейнера */
        #mobile-menu {
            min-height: auto;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* Стили для header-link на десктопе */
        .header-link {
            position: relative;
            text-decoration: none;
            color: #2F2F2F;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .header-link:hover {
            color: #FFC107;
        }
        
        .header-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: #FFC107;
            transition: width 0.3s ease;
        }
        
        .header-link:hover::after {
            width: 100%;
        }
        
        /* Стили для логотипа */
        .logo-image {
            height: 18px;
            width: auto;
            max-width: 60px;
            max-height: 18px;
        }
        
        /* Убираем стандартные стили для мобильного меню на больших экранах */
        @media (min-width: 768px) {
            #mobile-menu {
                display: none !important;
            }
            #mobile-menu-button {
                display: none !important;
            }
        }
        
        /* Дополнительные стили для мобильной версии */
        @media (max-width: 767px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            /* Полностью отключаем только десктопную навигацию на мобильных */
            #desktop-nav {
                display: none !important;
                pointer-events: none !important;
                visibility: hidden !important;
                position: static !important;
                z-index: -999 !important;
                left: auto !important;
                transform: none !important;
            }
            
            /* Убираем все взаимодействия с ссылками десктопной навигации на мобильных */
            #desktop-nav a {
                display: none !important;
                pointer-events: none !important;
                visibility: hidden !important;
                position: static !important;
                z-index: -999 !important;
            }
        }
    </style>
</head>
<body class="font-roboto text-dark-gray bg-white">
    <!-- Шапка сайта -->
    <header class="bg-white fixed w-full top-0 shadow-md z-50" style="position: fixed; top: 0; left: 0; right: 0;">
        <div class="container mx-auto py-2 px-4 flex justify-between items-center relative">
            <!-- Логотип -->
            <a href="index.html" class="flex items-center">
                <img src="Logo_black.svg" alt="Логотип" class="logo-image">
            </a>

            <!-- Навигация для десктопа (центрированная) -->
            <nav id="desktop-nav" class="hidden md:flex space-x-8 absolute left-1/2 transform -translate-x-1/2 pointer-events-none md:pointer-events-auto">
                <a href="portfolio.html" class="header-link">Портфолио</a>
                <a href="stages.html" class="header-link">Этапы работы</a>
                <a href="articles.html" class="header-link">Статьи</a>
                <a href="services.html" class="header-link">Услуги и цены</a>
                <a href="ai-design.html" class="header-link">ИИ дизайн</a>
                <a href="about.html" class="header-link">О нас</a>
                <a href="contacts.html" class="header-link">Контакты</a>
            </nav>

            <!-- Кнопка мобильного меню -->
            <button id="mobile-menu-button" class="md:hidden flex flex-col justify-center items-center w-10 h-10 focus:outline-none z-50">
                <span id="hamburger-line-1" class="block w-6 h-0.5 bg-dark-gray mb-1.5 transition-all duration-300 ease-in-out"></span>
                <span id="hamburger-line-2" class="block w-6 h-0.5 bg-dark-gray mb-1.5 transition-all duration-300 ease-in-out"></span>
                <span id="hamburger-line-3" class="block w-6 h-0.5 bg-dark-gray transition-all duration-300 ease-in-out"></span>
            </button>
        </div>

        <!-- Мобильное меню -->
        <div id="mobile-menu" class="md:hidden absolute top-full left-0 w-full bg-white shadow-lg transform -translate-y-full opacity-0 transition-all duration-300 ease-in-out z-40">
            <nav class="flex flex-col py-2">
                <a href="portfolio.html" class="mobile-menu-link">Портфолио</a>
                <a href="stages.html" class="mobile-menu-link">Этапы работы</a>
                <a href="articles.html" class="mobile-menu-link">Статьи</a>
                <a href="services.html" class="mobile-menu-link">Услуги и цены</a>
                <a href="ai-design.html" class="mobile-menu-link">ИИ дизайн</a>
                <a href="about.html" class="mobile-menu-link">О нас</a>
                <a href="contacts.html" class="mobile-menu-link">Контакты</a>
            </nav>
        </div>
    </header>

    <!-- Основное содержимое -->
    <main class="pt-24 pb-20">
        <div class="container mx-auto px-4 max-w-4xl">
            <div class="mb-4">
                <a href="articles.html" class="text-gray hover:text-gold-1 transition-colors flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    Назад к статьям
                </a>
            </div>
            
            <!-- Заголовок статьи -->
            <div class="mb-6">
                <h1 id="article-title" class="text-4xl md:text-5xl font-montserrat font-bold mb-4"></h1>
                <div class="flex items-center mb-6">
                    <span id="article-date" class="text-gray mr-4"></span>
                    <span id="article-category" class="bg-light-gray text-dark-gray text-sm font-medium px-2.5 py-0.5 rounded"></span>
                </div>
                <div class="w-20 h-1 bg-gold-1 mb-8"></div>
            </div>
            
            <!-- Изображение статьи -->
            <div class="mb-10">
                <div id="main-image-container" class="w-full h-[400px] bg-light-gray rounded-lg flex items-center justify-center">
                    <span class="text-2xl font-montserrat text-dark-gray">Изображение статьи</span>
                </div>
            </div>
            
            <!-- Содержание статьи -->
            <div id="article-content" class="prose prose-lg max-w-none mb-12">
                <!-- Здесь будет содержимое статьи с интегрированными иллюстрациями -->
            </div>
            
            <!-- Автор статьи -->
            <div class="bg-light-gray rounded-lg p-6 mb-10">
                <div class="mb-4">
                    <h3 id="article-author" class="text-lg font-montserrat font-semibold">Автор</h3>
                    <p class="text-gray">Архитектор</p>
                </div>
                <p id="author-bio" class="text-base">Биография автора и его опыт работы в области архитектуры и дизайна.</p>
            </div>
            
            <!-- Кнопка назад -->
            <div class="flex justify-center">
                <a href="articles.html" class="btn bg-dark-gray text-white hover:bg-gold-1 hover:text-black transition-colors">
                    Назад к статьям
                </a>
            </div>
            
        </div>
    </main>

    <!-- Подвал сайта -->
    <footer class="bg-dark-gray text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <div>
                    <h3 class="font-montserrat text-xl mb-4">Контакты</h3>
                    <ul class="space-y-2">
                        <li>Телефон: +7 (906) 729-99-17</li>
                        <li>Email: info@architecture-bureau.com</li>
                        <li>Адрес: г. Москва, Новинский бульвар 25 к.10 оф.18</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-montserrat text-xl mb-4">Наши услуги</h3>
                    <ul class="space-y-2">
                        <li><a href="services.html" class="text-white hover:text-gold-1 transition-colors">Архитектурное проектирование</a></li>
                        <li><a href="services.html" class="text-white hover:text-gold-1 transition-colors">Дизайн интерьера</a></li>
                        <li><a href="services.html" class="text-white hover:text-gold-1 transition-colors">Ландшафтный дизайн</a></li>
                        <li><a href="ai-design.html" class="text-white hover:text-gold-1 transition-colors">ИИ дизайн</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-montserrat text-xl mb-4">Информация</h3>
                    <ul class="space-y-2">
                        <li><a href="stages.html" class="text-white hover:text-gold-1 transition-colors">Этапы работы</a></li>
                        <li><a href="portfolio.html" class="text-white hover:text-gold-1 transition-colors">Портфолио</a></li>
                        <li><a href="about.html" class="text-white hover:text-gold-1 transition-colors">О нас</a></li>
                        <li><a href="articles.html" class="text-white hover:text-gold-1 transition-colors">Статьи</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="flex flex-col items-center mt-8 pt-8 border-t border-gray">
                <img src="Logo.svg" alt="Логотип" class="w-32 h-32 mb-4">
                <p class="text-center text-sm">© <span id="current-year"></span> Архитектурное Бюро. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script>
    // Функция для получения параметров из URL
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    
    // Получаем ID статьи из URL
    const articleId = getUrlParameter('id');
    
    // Загрузка данных статьи из API
    async function fetchArticleData(id) {
        try {
            const response = await fetch(`/api/db/articles/${id}`);
            const data = await response.json();
            
            if (data.success && data.article) {
                return data.article;
            } else {
                throw new Error(data.error || 'Статья не найдена');
            }
        } catch (error) {
            console.error('Ошибка загрузки статьи:', error);
            throw error;
        }
    }
    
    // Загрузка данных статьи
    async function loadArticleData() {
        if (!articleId) {
            showError('ID статьи не указан');
            return;
        }

        try {
            showLoading();
            const articleData = await fetchArticleData(articleId);
            
            // Заполняем данные на странице
            document.getElementById('article-title').textContent = articleData.title;
            document.getElementById('article-date').textContent = formatDate(articleData.publication_date);
            document.getElementById('article-category').textContent = articleData.category || 'Статья';
            
            // Автор статьи (берем первого автора)
            const mainAuthor = articleData.architects && articleData.architects.length > 0 
                ? articleData.architects[0] 
                : { full_name: 'Автор', bio: 'Биография автора' };
            
            document.getElementById('article-author').textContent = mainAuthor.full_name || 'Автор';
            document.getElementById('author-bio').textContent = mainAuthor.bio || 'Биография автора';
            
            // Главное изображение статьи
            const mainImageContainer = document.getElementById('main-image-container');
            if (articleData.main_image_url) {
                mainImageContainer.innerHTML = `
                    <img src="${articleData.main_image_url}" alt="${articleData.title}" 
                         class="w-full h-full object-cover rounded-lg">
                `;
            } else {
                mainImageContainer.innerHTML = `
                    <div class="w-full h-full bg-light-gray rounded-lg flex items-center justify-center">
                        <span class="text-2xl font-montserrat text-dark-gray">${articleData.title}</span>
                    </div>
                `;
            }
            
            // Загружаем контент статьи
            if (articleData.contentBlocks && articleData.contentBlocks.length > 0) {
                loadContentBlocks(articleData.contentBlocks);
            } else {
                // Если нет блоков контента, показываем сообщение
                document.getElementById('article-content').innerHTML = `
                    <div class="text-center py-12">
                        <p class="text-gray text-lg">Содержание статьи пока не добавлено</p>
                    </div>
                `;
            }
            
            // Обновляем заголовок страницы
            document.title = articleData.title + ' - Архитектурное Бюро';
            
        } catch (error) {
            console.error('Ошибка загрузки статьи:', error);
            showError(error.message || 'Не удалось загрузить статью');
        }
    }
    
    // Функция для загрузки блоков контента
    function loadContentBlocks(blocks) {
        const contentContainer = document.getElementById('article-content');
        contentContainer.innerHTML = ''; // Очищаем контейнер
        
        console.log('Загружаем блоки контента:', blocks);
        
        blocks.forEach((block, index) => {
            console.log(`Блок ${index}:`, block);
            
            let blockElement;
            switch (block.block_type) { // используем block_type из БД
                case 'text':
                    blockElement = createTextBlock(block.content);
                    break;
                case 'image':
                    blockElement = createImageBlock(block.image_url, block.caption);
                    break;
                case 'subtitle':
                    blockElement = createSubtitleBlock(block.content);
                    break;
                case 'quote':
                    blockElement = createQuoteBlock(block.content);
                    break;
                case 'list':
                    blockElement = createListBlock(block.content);
                    break;
                default:
                    console.warn('Неизвестный тип блока:', block.block_type);
                    return;
            }
            if (blockElement) {
                contentContainer.appendChild(blockElement);
            }
        });
    }
    
    // Создание текстового блока
    function createTextBlock(content) {
        if (!content || content.trim() === '') {
            return null; // Пропускаем пустые блоки
        }
        
        const block = document.createElement('div');
        block.className = 'text-block mb-8';
        
        // Проверяем, содержит ли контент HTML или это простой текст
        if (content.includes('<') && content.includes('>')) {
            // Если есть HTML-теги, вставляем как HTML
            block.innerHTML = content;
        } else {
            // Если простой текст, создаем параграф
            const paragraph = document.createElement('p');
            paragraph.className = 'text-lg leading-relaxed';
            paragraph.textContent = content;
            block.appendChild(paragraph);
        }
        
        return block;
    }
    
    // Создание блока с изображением
    function createImageBlock(imageUrl, caption) {
        if (!imageUrl || imageUrl.trim() === '') {
            return null; // Пропускаем блоки без изображений
        }
        
        const block = document.createElement('div');
        block.className = 'image-block my-8';
        
        const imageContainer = document.createElement('div');
        imageContainer.className = 'relative h-80 bg-light-gray rounded-lg flex items-center justify-center overflow-hidden';
        
        // Показываем загрузку
        imageContainer.innerHTML = `
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gold-1"></div>
        `;
        
        const image = document.createElement('img');
        image.src = imageUrl;
        image.alt = caption || 'Изображение статьи';
        image.className = 'w-full h-full object-cover rounded-lg';
        
        // Обработка успешной загрузки
        image.onload = function() {
            imageContainer.innerHTML = '';
            imageContainer.appendChild(image);
        };
        
        // Обработка ошибки загрузки изображения
        image.onerror = function() {
            console.error('Ошибка загрузки изображения:', imageUrl);
            imageContainer.innerHTML = `
                <div class="text-center">
                    <div class="text-red-500 text-xl mb-2">⚠️</div>
                    <span class="text-lg font-montserrat text-dark-gray">
                        Изображение недоступно
                    </span>
                </div>
            `;
        };
        
        block.appendChild(imageContainer);
        
        if (caption && caption.trim() !== '') {
            const captionElement = document.createElement('p');
            captionElement.className = 'text-sm text-gray text-center mt-3 italic';
            captionElement.textContent = caption;
            block.appendChild(captionElement);
        }
        
        return block;
    }
    
    // Создание блока подзаголовка
    function createSubtitleBlock(content) {
        if (!content || content.trim() === '') {
            return null;
        }
        
        const block = document.createElement('div');
        block.className = 'subtitle-block my-8';
        
        const subtitle = document.createElement('h3');
        subtitle.className = 'text-2xl font-montserrat font-semibold text-dark-gray mb-4';
        subtitle.textContent = content;
        
        block.appendChild(subtitle);
        return block;
    }
    
    // Создание блока цитаты
    function createQuoteBlock(content) {
        if (!content || content.trim() === '') {
            return null;
        }
        
        const block = document.createElement('div');
        block.className = 'quote-block my-8';
        
        const quote = document.createElement('blockquote');
        quote.className = 'border-l-4 border-gold-1 pl-6 py-4 bg-light-gray/50 rounded-r-lg';
        
        const text = document.createElement('p');
        text.className = 'text-lg italic text-dark-gray leading-relaxed';
        text.textContent = content;
        
        quote.appendChild(text);
        block.appendChild(quote);
        return block;
    }
    
    // Создание блока списка
    function createListBlock(content) {
        if (!content || content.trim() === '') {
            return null;
        }
        
        const block = document.createElement('div');
        block.className = 'list-block my-8';
        
        // Разделяем контент на элементы списка
        const items = content.split('\n').filter(item => item.trim() !== '');
        
        const list = document.createElement('ul');
        list.className = 'space-y-2 text-lg leading-relaxed';
        
        items.forEach(item => {
            const listItem = document.createElement('li');
            listItem.className = 'flex items-start';
            listItem.innerHTML = `
                <span class="text-gold-1 mr-3 mt-1">•</span>
                <span>${item.trim()}</span>
            `;
            list.appendChild(listItem);
        });
        
        block.appendChild(list);
        return block;
    }
    
    function showLoading() {
        const content = document.getElementById('article-content');
        content.innerHTML = `
            <div class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gold-1 mx-auto mb-4"></div>
                <p class="text-gray">Загрузка статьи...</p>
            </div>
        `;
    }

    function showError(message) {
        const content = document.getElementById('article-content');
        content.innerHTML = `
            <div class="text-center py-12">
                <div class="text-red-500 text-lg mb-4">⚠️ ${message}</div>
                <a href="articles.html" class="bg-gold-1 text-black px-6 py-2 rounded hover:bg-gold-2 transition-colors inline-block">
                    Назад к статьям
                </a>
            </div>
        `;
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        const months = [
            'января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
            'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'
        ];
        
        const day = date.getDate();
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${day} ${month} ${year}`;
    }
    
    // Загружаем данные при загрузке страницы
    document.addEventListener('DOMContentLoaded', loadArticleData);
    
    // Установка текущего года в футере
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('current-year').textContent = new Date().getFullYear();
    });
    
    // Обработка мобильного меню
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const line1 = document.getElementById('hamburger-line-1');
        const line2 = document.getElementById('hamburger-line-2');
        const line3 = document.getElementById('hamburger-line-3');
        
        let isMenuOpen = false;
        
        mobileMenuButton.addEventListener('click', function() {
            if (isMenuOpen) {
                // Закрываем меню
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                
                // Анимация гамбургера обратно
                line1.classList.remove('rotate-45', 'translate-y-2');
                line2.classList.remove('opacity-0');
                line3.classList.remove('-rotate-45', '-translate-y-2');
                
                isMenuOpen = false;
            } else {
                // Открываем меню
                mobileMenu.classList.remove('-translate-y-full', 'opacity-0');
                mobileMenu.classList.add('translate-y-0', 'opacity-100');
                
                // Анимация гамбургера в крестик
                line1.classList.add('rotate-45', 'translate-y-2');
                line2.classList.add('opacity-0');
                line3.classList.add('-rotate-45', '-translate-y-2');
                
                isMenuOpen = true;
            }
        });
        
        // Закрывать меню при клике на ссылку
        const menuLinks = document.querySelectorAll('.mobile-menu-link');
        menuLinks.forEach(link => {
            link.addEventListener('click', function() {
                // Закрываем меню
                mobileMenu.classList.remove('translate-y-0', 'opacity-100');
                mobileMenu.classList.add('-translate-y-full', 'opacity-0');
                
                // Анимация гамбургера обратно
                line1.classList.remove('rotate-45', 'translate-y-2');
                line2.classList.remove('opacity-0');
                line3.classList.remove('-rotate-45', '-translate-y-2');
                
                isMenuOpen = false;
            });
        });
    });
    </script>
</body>
</html> 