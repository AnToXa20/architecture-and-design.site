<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API —Å—Ç–∞—Ç–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .drag-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }
        .drag-area.drag-over {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
                üß™ –¢–µ—Å—Ç API —Å—Ç–∞—Ç–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
            </h1>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- –§–æ—Ä–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h2>
                    
                    <form id="test-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</label>
                            <input type="text" id="title" value="–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏" 
                                   class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="category" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                <option value="interior">–î–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞</option>
                                <option value="architecture">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</option>
                                <option value="country">–ó–∞–≥–æ—Ä–æ–¥–Ω—ã–µ –¥–æ–º–∞</option>
                                <option value="landscape">–õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω</option>
                                <option value="technology">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                            <input type="date" id="publicationDate" 
                                   class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ê–≤—Ç–æ—Ä</label>
                            <select id="authorId" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="shortDescription" rows="3" 
                                      placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏..."
                                      class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–ø–∫—É pic2/articles/</textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                            <div class="drag-area" id="main-image-area">
                                <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <button type="button" id="main-image-btn" class="text-blue-600 underline">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</button></p>
                                <input type="file" id="main-image" accept="image/*" style="display: none;">
                                <div id="main-image-preview" class="mt-3 hidden">
                                    <img src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" class="max-h-32 mx-auto rounded">
                                    <p class="text-sm text-gray-600 mt-2"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">–ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                            <div class="space-y-2">
                                <div>
                                    <button type="button" id="add-text-block" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">+ –¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫</button>
                                    <button type="button" id="add-image-block" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">+ –ë–ª–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
                                </div>
                                <div id="content-blocks" class="space-y-3 mt-4">
                                    <div class="text-gray-500 text-center py-4 border-2 border-dashed border-gray-300 rounded">
                                        –î–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                                üöÄ –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- –õ–æ–≥–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">–õ–æ–≥–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-medium text-gray-600 mb-2">–°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞</h3>
                            <div id="status" class="p-3 rounded bg-gray-100 text-gray-600">
                                –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium text-gray-600 mb-2">–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏</h3>
                            <div id="logs" class="log-area text-sm">
                                –õ–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...
                            </div>
                            <button type="button" id="clear-logs" class="mt-2 text-sm text-red-600 hover:text-red-800">
                                –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
                            </button>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium text-gray-600 mb-2">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" id="load-authors" class="bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                                    –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤—Ç–æ—Ä–æ–≤
                                </button>
                                <button type="button" id="check-folders" class="bg-yellow-500 text-white px-3 py-2 rounded text-sm hover:bg-yellow-600">
                                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–ø–∫–∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let blockCounter = 0;
        let imageCounter = 0;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const form = document.getElementById('test-form');
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        const contentBlocksDiv = document.getElementById('content-blocks');
        const authorSelect = document.getElementById('authorId');

        // –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const typeEmoji = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            
            const logEntry = `[${timestamp}] ${typeEmoji[type]} ${message}`;
            logsDiv.innerHTML += logEntry + '\n';
            logsDiv.scrollTop = logsDiv.scrollHeight;
            console.log(logEntry);
        }

        function updateStatus(message, type = 'info') {
            const colors = {
                'info': 'bg-blue-100 text-blue-800',
                'success': 'bg-green-100 text-green-800',
                'error': 'bg-red-100 text-red-800',
                'warning': 'bg-yellow-100 text-yellow-800'
            };
            
            statusDiv.className = `p-3 rounded ${colors[type]}`;
            statusDiv.textContent = message;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤
        async function loadAuthors() {
            try {
                log('–ó–∞–≥—Ä—É–∂–∞—é —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤...');
                updateStatus('–ó–∞–≥—Ä—É–∂–∞—é –∞–≤—Ç–æ—Ä–æ–≤...', 'info');
                
                const response = await fetch('/api/db/architects');
                const data = await response.json();
                
                if (data.success && data.architects) {
                    authorSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞</option>';
                    data.architects.forEach(architect => {
                        const option = document.createElement('option');
                        option.value = architect.id;
                        option.textContent = architect.full_name;
                        authorSelect.appendChild(option);
                    });
                    
                    log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.architects.length} –∞–≤—Ç–æ—Ä–æ–≤`, 'success');
                    updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.architects.length} –∞–≤—Ç–æ—Ä–æ–≤`, 'success');
                } else {
                    throw new Error(data.error || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–≤—Ç–æ—Ä–∞—Ö');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ—Ä–æ–≤: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ—Ä–æ–≤', 'error');
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ drag & drop –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function setupMainImageUpload() {
            const area = document.getElementById('main-image-area');
            const btn = document.getElementById('main-image-btn');
            const input = document.getElementById('main-image');
            const preview = document.getElementById('main-image-preview');

            btn.addEventListener('click', () => input.click());

            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('drag-over');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('drag-over');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    showImagePreview(files[0], preview);
                }
            });

            input.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    showImagePreview(e.target.files[0], preview);
                }
            });
        }

        function showImagePreview(file, previewDiv) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = previewDiv.querySelector('img');
                const text = previewDiv.querySelector('p');
                
                img.src = e.target.result;
                text.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                previewDiv.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function addTextBlock() {
            const blockId = `text-block-${blockCounter++}`;
            const block = document.createElement('div');
            block.className = 'border border-gray-300 rounded p-3';
            block.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-700">–¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫</span>
                    <button type="button" onclick="removeBlock('${blockId}')" class="text-red-600 hover:text-red-800 text-sm">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
                <textarea class="w-full p-2 border border-gray-300 rounded" rows="3" 
                          placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞...">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ —Å—Ç–∞—Ç—å–∏.</textarea>
            `;
            block.id = blockId;
            
            removeEmptyPlaceholder();
            contentBlocksDiv.appendChild(block);
        }

        function addImageBlock() {
            const blockId = `image-block-${blockCounter++}`;
            const imgId = `block-image-${imageCounter++}`;
            
            const block = document.createElement('div');
            block.className = 'border border-gray-300 rounded p-3';
            block.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-700">–ë–ª–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                    <button type="button" onclick="removeBlock('${blockId}')" class="text-red-600 hover:text-red-800 text-sm">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
                <div class="drag-area" data-image-id="${imgId}">
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ <button type="button" class="text-blue-600 underline">–≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</button></p>
                    <input type="file" accept="image/*" style="display: none;" data-image-index="${imageCounter - 1}">
                    <div class="image-preview mt-3 hidden">
                        <img src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" class="max-h-32 mx-auto rounded">
                        <p class="text-sm text-gray-600 mt-2"></p>
                    </div>
                </div>
                <div class="mt-2">
                    <input type="text" placeholder="–ü–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é..." 
                           class="w-full p-2 border border-gray-300 rounded text-sm">
                </div>
            `;
            block.id = blockId;
            
            removeEmptyPlaceholder();
            contentBlocksDiv.appendChild(block);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞
            setupBlockImageUpload(block);
        }

        function setupBlockImageUpload(block) {
            const area = block.querySelector('.drag-area');
            const btn = area.querySelector('button');
            const input = area.querySelector('input[type="file"]');
            const preview = area.querySelector('.image-preview');

            btn.addEventListener('click', () => input.click());

            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('drag-over');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('drag-over');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    showImagePreview(files[0], preview);
                }
            });

            input.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    showImagePreview(e.target.files[0], preview);
                }
            });
        }

        function removeBlock(blockId) {
            document.getElementById(blockId).remove();
            if (contentBlocksDiv.children.length === 0) {
                contentBlocksDiv.innerHTML = '<div class="text-gray-500 text-center py-4 border-2 border-dashed border-gray-300 rounded">–î–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</div>';
            }
        }

        function removeEmptyPlaceholder() {
            const placeholder = contentBlocksDiv.querySelector('.text-gray-500');
            if (placeholder) {
                placeholder.remove();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                log('–ù–∞—á–∏–Ω–∞—é —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏...');
                updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏...', 'info');
                
                const formData = new FormData();
                
                // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                formData.append('title', document.getElementById('title').value);
                formData.append('category', document.getElementById('category').value);
                formData.append('publicationDate', document.getElementById('publicationDate').value);
                formData.append('authorId', document.getElementById('authorId').value);
                formData.append('shortDescription', document.getElementById('shortDescription').value);
                
                // –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const mainImage = document.getElementById('main-image').files[0];
                if (mainImage) {
                    formData.append('mainImage', mainImage);
                    log(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${mainImage.name}`);
                }
                
                // –ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                const contentBlocks = [];
                let imageIndex = 0;
                
                Array.from(contentBlocksDiv.children).forEach((block, order) => {
                    if (block.classList.contains('text-gray-500')) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º placeholder
                    
                    const textarea = block.querySelector('textarea');
                    const imageInput = block.querySelector('input[type="file"]');
                    
                    if (textarea && textarea.value.trim()) {
                        contentBlocks.push({
                            type: 'text',
                            content: textarea.value.trim(),
                            order: order
                        });
                        log(`–î–æ–±–∞–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ ${order}`);
                    }
                    
                    if (imageInput && imageInput.files[0]) {
                        const captionInput = block.querySelector('input[type="text"]');
                        const caption = captionInput ? captionInput.value : '';
                        
                        formData.append(`blockImage_${imageIndex}`, imageInput.files[0]);
                        
                        contentBlocks.push({
                            type: 'image',
                            caption: caption,
                            imageIndex: imageIndex,
                            order: order
                        });
                        
                        log(`–î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ${order} (–∏–Ω–¥–µ–∫—Å: ${imageIndex})`);
                        imageIndex++;
                    }
                });
                
                formData.append('contentBlocks', JSON.stringify(contentBlocks));
                log(`–í—Å–µ–≥–æ –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${contentBlocks.length}`);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                log('–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/db/articles-local...');
                const response = await fetch('/api/db/articles-local', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                log(`–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    log(`‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! ID: ${result.articleId}, Slug: ${result.slug}`, 'success');
                    updateStatus(`–°—Ç–∞—Ç—å—è —Å–æ–∑–¥–∞–Ω–∞! ID: ${result.articleId}`, 'success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏
                    setTimeout(() => {
                        log(`üìÅ –ü–∞–ø–∫–∞ —Å—Ç–∞—Ç—å–∏: pic2/articles/${result.slug}/`);
                        log(`üîó –ü—Ä–æ—Å–º–æ—Ç—Ä: article.html?id=${result.articleId}`);
                    }, 500);
                } else {
                    throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏', 'error');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('add-text-block').addEventListener('click', addTextBlock);
        document.getElementById('add-image-block').addEventListener('click', addImageBlock);
        document.getElementById('load-authors').addEventListener('click', loadAuthors);
        document.getElementById('clear-logs').addEventListener('click', () => {
            logsDiv.innerHTML = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        });

        document.getElementById('check-folders').addEventListener('click', async () => {
            try {
                log('–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫...');
                updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ø–æ–∫...', 'info');
                
                const response = await fetch('/api/debug/folders');
                const result = await response.json();
                
                if (result.success) {
                    log('üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞', 'success');
                    updateStatus('–ü–∞–ø–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ', 'success');
                } else {
                    log('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞–ø–∫–∞–º–∏: ' + result.error, 'warning');
                    updateStatus('–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞–ø–∫–∞–º–∏', 'warning');
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–ø–æ–∫: ' + error.message, 'error');
                updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–ø–æ–∫', 'error');
            }
        });

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
        window.removeBlock = removeBlock;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            document.getElementById('publicationDate').value = new Date().toISOString().split('T')[0];
            
            setupMainImageUpload();
            loadAuthors();
            
            log('üìã –§–æ—Ä–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        });
    </script>
</body>
</html> 